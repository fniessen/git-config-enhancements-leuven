#!/usr/bin/env bash

# Set the default threshold (7 days ago) or use the first argument if provided.
threshold_days=${1:-7}
threshold_date=$(date -d "$threshold_days days ago" +%Y-%m-%d)

# Fetch remote branches and filter by last commit date.
git fetch --prune
branches=$(git for-each-ref --sort='-committerdate' --format='%(refname:short)' refs/remotes | grep -v HEAD)

# Loop through branches and check if they've been modified within the threshold days.
for branch in $branches; do
    last_commit_info=$(git show -s --format='%ci' $branch | head -n 1)
    last_commit_date=$(echo "$last_commit_info" | awk '{print $1}')
    last_commit_time=$(echo "$last_commit_info" | awk '{print $2}')
    author=$(git show -s --format='%an' $branch | head -n 1)
    last_commit_date=$(date -d "$last_commit_date" +%Y-%m-%d)
    day_of_week=$(date -d "$last_commit_date" "+%a")
    last_commit_time=$(date -d "$last_commit_time" "+%H:%M")
    timestamp="\e[32m$last_commit_date $day_of_week $last_commit_time\e[0m"
    author="\e[34m<$author>\e[0m"
    branch="\e[1;31m$branch\e[0m"
    if [[ "$last_commit_date" > "$threshold_date" ]]; then
        echo -e "$timestamp - Branch $branch $author"
    fi
done
