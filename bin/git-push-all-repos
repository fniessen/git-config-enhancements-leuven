#!/usr/bin/env bash

# Push the latest changes for each Git repository found in the current directory.

# Find all Git repositories recursively.
repos=$(find . -type d -name ".git")

# Push the latest changes for each repository.
for repo in $repos; do
    repo_dir=$(dirname "$repo")
    echo -e "\nPushing latest changes for repository in $(tput bold)${repo_dir##*/}$(tput sgr0)..."

    # Push changes.
    if ! output=$(git -C "$repo_dir" push 2>&1); then
        echo "$(tput setaf 1)$output$(tput sgr0)"
    else
        echo "$(tput setaf 2)$output$(tput sgr0)"
    fi

    # Display modified files in yellow bold.
    modified_files=$(git -C "$repo_dir" modified-files)
    if [ -n "$modified_files" ]; then
        echo "$(tput setaf 3)$(tput bold)Modified files:$(tput sgr0)"
        echo "$(tput setaf 3)$(tput bold)$modified_files$(tput sgr0)"
    fi
done
